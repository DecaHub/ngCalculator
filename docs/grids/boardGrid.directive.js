"use strict";

/* global $ */

angular.module("grids").directive("dhBoardGrid", ["CentralDataService", "$rootScope", function (CentralDataService, $rootScope) {

	return {

		restrict: "E",
		templateUrl: "grids/boardGrid.template.html",
		link: function link(scope, element, attr) {

			// Initial board value is zero
			scope.displayNumber = 0;

			var defaultFontSize = 48;

			var getWidth = function getWidth(el) {

				var cs = getComputedStyle(el);

				var paddingX = parseFloat(cs.paddingLeft) * 2;
				var borderX = parseFloat(cs.borderLeftWidth) * 2;

				return el.getBoundingClientRect().width - paddingX - borderX;
			};

			var digitBox = element[0].querySelector("#digitBox");

			var digitBoxFontPadding = parseInt(digitBox.style.padding = 10, 10);
			var digitBoxFontSize = parseInt(digitBox.style.fontSize = 10, 10);

			var maxWidth = getWidth(element[0]) - digitBoxFontPadding * 2;

			scope.$on("number:change", function (event, data) {

				scope.displayNumber = data;

				digitBox.innerHTML = scope.displayNumber.toString();

				$rootScope.$broadcast("digitBox:change");
			});

			scope.$on("digitBox:change", function (event) {

				if (scope.displayNumber.toString().length === 1) {

					digitBoxFontSize = defaultFontSize;

					digitBox.style.fontSize = digitBoxFontSize + "px";

					return;
				}

				while (getWidth(digitBox) > maxWidth) {

					digitBoxFontSize -= 1;

					digitBox.style.fontSize = digitBoxFontSize + "px";
				}
			});
		}
	};
}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdyaWRzL2JvYXJkR3JpZC5kaXJlY3RpdmUuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImRpcmVjdGl2ZSIsIkNlbnRyYWxEYXRhU2VydmljZSIsIiRyb290U2NvcGUiLCJyZXN0cmljdCIsInRlbXBsYXRlVXJsIiwibGluayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHIiLCJkaXNwbGF5TnVtYmVyIiwiZGVmYXVsdEZvbnRTaXplIiwiZ2V0V2lkdGgiLCJlbCIsImNzIiwiZ2V0Q29tcHV0ZWRTdHlsZSIsInBhZGRpbmdYIiwicGFyc2VGbG9hdCIsInBhZGRpbmdMZWZ0IiwiYm9yZGVyWCIsImJvcmRlckxlZnRXaWR0aCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsIndpZHRoIiwiZGlnaXRCb3giLCJxdWVyeVNlbGVjdG9yIiwiZGlnaXRCb3hGb250UGFkZGluZyIsInBhcnNlSW50Iiwic3R5bGUiLCJwYWRkaW5nIiwiZGlnaXRCb3hGb250U2l6ZSIsImZvbnRTaXplIiwibWF4V2lkdGgiLCIkb24iLCJldmVudCIsImRhdGEiLCJpbm5lckhUTUwiLCJ0b1N0cmluZyIsIiRicm9hZGNhc3QiLCJsZW5ndGgiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBOztBQUVBQSxRQUFRQyxNQUFSLENBQWUsT0FBZixFQUNFQyxTQURGLENBQ1ksYUFEWixFQUMyQixDQUFDLG9CQUFELEVBQXVCLFlBQXZCLEVBQXFDLFVBQVVDLGtCQUFWLEVBQThCQyxVQUE5QixFQUEwQzs7QUFFeEcsUUFBTzs7QUFFTkMsWUFBVSxHQUZKO0FBR05DLGVBQWEsK0JBSFA7QUFJTkMsTUFKTSxnQkFJQUMsS0FKQSxFQUlPQyxPQUpQLEVBSWdCQyxJQUpoQixFQUlzQjs7QUFFM0I7QUFDQUYsU0FBTUcsYUFBTixHQUFzQixDQUF0Qjs7QUFFQSxPQUFNQyxrQkFBa0IsRUFBeEI7O0FBRUEsT0FBTUMsV0FBVyxTQUFYQSxRQUFXLENBQVVDLEVBQVYsRUFBYzs7QUFFOUIsUUFBTUMsS0FBS0MsaUJBQWlCRixFQUFqQixDQUFYOztBQUVBLFFBQU1HLFdBQVdDLFdBQVdILEdBQUdJLFdBQWQsSUFBNkIsQ0FBOUM7QUFDQSxRQUFNQyxVQUFVRixXQUFXSCxHQUFHTSxlQUFkLElBQWlDLENBQWpEOztBQUVBLFdBQU9QLEdBQUdRLHFCQUFILEdBQTJCQyxLQUEzQixHQUFtQ04sUUFBbkMsR0FBOENHLE9BQXJEO0FBRUEsSUFURDs7QUFXQSxPQUFNSSxXQUFXZixRQUFRLENBQVIsRUFBV2dCLGFBQVgsQ0FBeUIsV0FBekIsQ0FBakI7O0FBRUEsT0FBTUMsc0JBQXNCQyxTQUFTSCxTQUFTSSxLQUFULENBQWVDLE9BQWYsR0FBeUIsRUFBbEMsRUFBc0MsRUFBdEMsQ0FBNUI7QUFDQSxPQUFJQyxtQkFBbUJILFNBQVNILFNBQVNJLEtBQVQsQ0FBZUcsUUFBZixHQUEwQixFQUFuQyxFQUF1QyxFQUF2QyxDQUF2Qjs7QUFFQSxPQUFNQyxXQUFXbkIsU0FBU0osUUFBUSxDQUFSLENBQVQsSUFBd0JpQixzQkFBc0IsQ0FBL0Q7O0FBRUFsQixTQUFNeUIsR0FBTixDQUFVLGVBQVYsRUFBMkIsVUFBVUMsS0FBVixFQUFpQkMsSUFBakIsRUFBdUI7O0FBRWpEM0IsVUFBTUcsYUFBTixHQUFzQndCLElBQXRCOztBQUVBWCxhQUFTWSxTQUFULEdBQXFCNUIsTUFBTUcsYUFBTixDQUFvQjBCLFFBQXBCLEVBQXJCOztBQUVBakMsZUFBV2tDLFVBQVgsQ0FBc0IsaUJBQXRCO0FBRUEsSUFSRDs7QUFVQTlCLFNBQU15QixHQUFOLENBQVUsaUJBQVYsRUFBNkIsVUFBVUMsS0FBVixFQUFpQjs7QUFFN0MsUUFBSTFCLE1BQU1HLGFBQU4sQ0FBb0IwQixRQUFwQixHQUErQkUsTUFBL0IsS0FBMEMsQ0FBOUMsRUFBaUQ7O0FBRWhEVCx3QkFBbUJsQixlQUFuQjs7QUFFQVksY0FBU0ksS0FBVCxDQUFlRyxRQUFmLEdBQTZCRCxnQkFBN0I7O0FBRUE7QUFFQTs7QUFFRCxXQUFPakIsU0FBU1csUUFBVCxJQUFxQlEsUUFBNUIsRUFBc0M7O0FBRXJDRix5QkFBb0IsQ0FBcEI7O0FBRUFOLGNBQVNJLEtBQVQsQ0FBZUcsUUFBZixHQUE2QkQsZ0JBQTdCO0FBRUE7QUFFRCxJQXBCRDtBQXNCQTtBQTdESyxFQUFQO0FBaUVBLENBbkV5QixDQUQzQiIsImZpbGUiOiJncmlkcy9ib2FyZEdyaWQuZGlyZWN0aXZlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qIGdsb2JhbCAkICovXG5cbmFuZ3VsYXIubW9kdWxlKFwiZ3JpZHNcIilcblx0LmRpcmVjdGl2ZShcImRoQm9hcmRHcmlkXCIsIFtcIkNlbnRyYWxEYXRhU2VydmljZVwiLCBcIiRyb290U2NvcGVcIiwgZnVuY3Rpb24gKENlbnRyYWxEYXRhU2VydmljZSwgJHJvb3RTY29wZSkge1xuXHRcdFxuXHRcdHJldHVybiB7XG5cdFx0XHRcblx0XHRcdHJlc3RyaWN0OiBcIkVcIixcblx0XHRcdHRlbXBsYXRlVXJsOiBcImdyaWRzL2JvYXJkR3JpZC50ZW1wbGF0ZS5odG1sXCIsXG5cdFx0XHRsaW5rIChzY29wZSwgZWxlbWVudCwgYXR0cikge1xuXHRcdFx0XHRcblx0XHRcdFx0Ly8gSW5pdGlhbCBib2FyZCB2YWx1ZSBpcyB6ZXJvXG5cdFx0XHRcdHNjb3BlLmRpc3BsYXlOdW1iZXIgPSAwO1xuXHRcdFx0XHRcblx0XHRcdFx0Y29uc3QgZGVmYXVsdEZvbnRTaXplID0gNDg7XG5cdFx0XHRcdFxuXHRcdFx0XHRjb25zdCBnZXRXaWR0aCA9IGZ1bmN0aW9uIChlbCkge1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGNvbnN0IGNzID0gZ2V0Q29tcHV0ZWRTdHlsZShlbCk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0Y29uc3QgcGFkZGluZ1ggPSBwYXJzZUZsb2F0KGNzLnBhZGRpbmdMZWZ0KSAqIDI7XG5cdFx0XHRcdFx0Y29uc3QgYm9yZGVyWCA9IHBhcnNlRmxvYXQoY3MuYm9yZGVyTGVmdFdpZHRoKSAqIDI7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0cmV0dXJuIGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoIC0gcGFkZGluZ1ggLSBib3JkZXJYO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHR9O1xuXHRcdFx0XHRcblx0XHRcdFx0Y29uc3QgZGlnaXRCb3ggPSBlbGVtZW50WzBdLnF1ZXJ5U2VsZWN0b3IoXCIjZGlnaXRCb3hcIik7XG5cdFx0XHRcdFxuXHRcdFx0XHRjb25zdCBkaWdpdEJveEZvbnRQYWRkaW5nID0gcGFyc2VJbnQoZGlnaXRCb3guc3R5bGUucGFkZGluZyA9IDEwLCAxMCk7XG5cdFx0XHRcdGxldCBkaWdpdEJveEZvbnRTaXplID0gcGFyc2VJbnQoZGlnaXRCb3guc3R5bGUuZm9udFNpemUgPSAxMCwgMTApO1xuXHRcdFx0XHRcblx0XHRcdFx0Y29uc3QgbWF4V2lkdGggPSBnZXRXaWR0aChlbGVtZW50WzBdKSAtIChkaWdpdEJveEZvbnRQYWRkaW5nICogMik7XG5cdFx0XHRcdFxuXHRcdFx0XHRzY29wZS4kb24oXCJudW1iZXI6Y2hhbmdlXCIsIGZ1bmN0aW9uIChldmVudCwgZGF0YSkge1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHNjb3BlLmRpc3BsYXlOdW1iZXIgPSBkYXRhO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGRpZ2l0Qm94LmlubmVySFRNTCA9IHNjb3BlLmRpc3BsYXlOdW1iZXIudG9TdHJpbmcoKTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHQkcm9vdFNjb3BlLiRicm9hZGNhc3QoXCJkaWdpdEJveDpjaGFuZ2VcIik7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRcblx0XHRcdFx0c2NvcGUuJG9uKFwiZGlnaXRCb3g6Y2hhbmdlXCIsIGZ1bmN0aW9uIChldmVudCkge1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmIChzY29wZS5kaXNwbGF5TnVtYmVyLnRvU3RyaW5nKCkubGVuZ3RoID09PSAxKSB7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGRpZ2l0Qm94Rm9udFNpemUgPSBkZWZhdWx0Rm9udFNpemU7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGRpZ2l0Qm94LnN0eWxlLmZvbnRTaXplID0gYCR7ZGlnaXRCb3hGb250U2l6ZX1weGA7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdFx0d2hpbGUgKGdldFdpZHRoKGRpZ2l0Qm94KSA+IG1heFdpZHRoKSB7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGRpZ2l0Qm94Rm9udFNpemUgLT0gMTtcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0ZGlnaXRCb3guc3R5bGUuZm9udFNpemUgPSBgJHtkaWdpdEJveEZvbnRTaXplfXB4YDtcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcblx0XHRcdFx0fSk7XG5cdFx0XHRcdFxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0fTtcblx0XHRcblx0fV0pO1xuIl19
