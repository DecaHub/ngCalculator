"use strict";angular.module("main",["grids"]),angular.module("auxiliary",[]),angular.module("grids",["numbers","operations","auxiliary"]),angular.module("numbers",[]),angular.module("operations",[]),angular.module("auxiliary").directive("dhAuxiliary",["CentralDataService",function(e){return{restrict:"E",scope:{aux:"<"},templateUrl:"aux/auxiliary.template.html",link:function(r,t,n){t.on("click",function(){e.storeCurrentOp(r.aux)})}}}]);var AuxGridController=function(e){this.aux=e.getAux()};AuxGridController.$inject=["AuxiliaryService"],angular.module("grids").directive("dhAuxGrid",function(){return{controller:AuxGridController,controllerAs:"auxGrid",restrict:"E",templateUrl:"grids/auxiliaryGrid.template.html"}}),angular.module("grids").directive("dhBoardGrid",["CentralDataService","$rootScope",function(e,r){return{restrict:"E",templateUrl:"grids/boardGrid.template.html",link:function(e,t,n){e.displayNumber=0;var u=function(e){var r=getComputedStyle(e),t=2*parseFloat(r.paddingLeft),n=2*parseFloat(r.borderLeftWidth);return e.getBoundingClientRect().width-t-n},i=t[0].querySelector("#digitBox"),a=parseInt(i.style.padding=10,10),o=parseInt(i.style.fontSize=10,10),l=u(t[0])-2*a;e.$on("number:change",function(t,n){e.displayNumber=n,i.innerHTML=e.displayNumber.toString(),r.$broadcast("digitBox:change")}),e.$on("digitBox:change",function(r){if(1===e.displayNumber.toString().length)return o=48,void(i.style.fontSize=o+"px");for(;u(i)>l;)o-=1,i.style.fontSize=o+"px"})}}}]),angular.module("grids").directive("dhCalculatorGrid",["$document",function(e){return{restrict:"E",templateUrl:"grids/calculatorGrid.template.html",link:function(r,t,n){var u=0,i=0,a=0,o=0,l=t.find("dh-board-grid"),c=function(e){o=e.pageY-i,a=e.pageX-u,t.css({top:o+"px",left:a+"px"})},s=function r(){e.off("mousemove",c),e.off("mouseup",r)};l.css({cursor:"pointer"}),t.css({position:"relative"}),l.on("mousedown",function(r){r.preventDefault(),u=r.pageX-a,i=r.pageY-o,e.on("mousemove",c),e.on("mouseup",s)})}}}]);var NumberGridController=function(e,r){var t=this;t.numbers=e.getNumbers(),t.dot=r.getDot()};NumberGridController.$inject=["NumbersService","AuxiliaryService"],angular.module("grids").directive("dhNumberGrid",function(){return{restrict:"E",templateUrl:"grids/numberGrid.template.html",controller:NumberGridController,controllerAs:"numGrid"}});var OperationGridController=function(e){this.operations=e.getOperations()};OperationGridController.$inject=["OperationsService"],angular.module("grids").directive("dhOperationGrid",function(){return{controller:OperationGridController,controllerAs:"opGrid",restrict:"E",templateUrl:"grids/operationGrid.template.html"}}),angular.module("numbers").directive("dhNumber",["CentralDataService",function(e){return{restrict:"E",scope:{digit:"<"},templateUrl:"number/number.template.html",link:function(r,t,n){t.on("click",function(){e.storeCurrentNumber(r.digit)})}}}]),angular.module("operations").directive("dhOperation",["CentralDataService",function(e){return{restrict:"E",scope:{op:"<"},templateUrl:"operation/operation.template.html",link:function(r,t,n){t.on("click",function(){e.storeCurrentOp(r.op)})}}}]),angular.module("main").service("OperationLogicService",["$rootScope","UtilService",function(e,r){math.config({number:"BigNumber",precision:20});var t=!1,n=function(e){console.log("**********************************************"),console.log("NUM STACK");for(var r="[",t=0;t<e.numberStack.length;++t)t===e.numberStack.length-1?r+=""+e.numberStack[t]:r+=e.numberStack[t]+", ";r+="]",console.log(r),console.log("OP STACK"),console.log(e.opStack),console.log("FULL STACK"),console.log(e.stack),console.log("**********************************************")},u=function(e){return"addition"===e||"subtraction"===e||"resultant"===e?0:"multiplication"===e||"division"===e?1:null},i=function(t,n){var u=null,i=null,a=null;switch("posneg"!==t&&"percentage"!==t&&(a=math.bignumber(n.numberStack.pop()),i=math.bignumber(n.numberStack.pop())),t){case"addition":u=math.add(i,a);break;case"subtraction":u=math.subtract(i,a);break;case"multiplication":u=math.multiply(i,a);break;case"division":u=math.divide(i,a);break;case"percentage":if(r.isNull(n.currentNumber)&&r.isEmpty(n.numberStack))return;if(!r.isNull(n.currentNumber)&&r.isEmpty(n.numberStack))return u=math.divide(n.currentNumber,100),n.currentNumber=u,void e.$broadcast("number:change",n.currentNumber);if(!r.isNull(n.currentNumber)&&!r.isEmpty(n.numberStack)){var o=n.numberStack[n.numberStack.length-1];u=math.multiply(o,math.divide(n.currentNumber,100)),n.currentNumber=u,n.percentageEntered=!0}break;case"posneg":if(r.isNull(n.currentNumber)){var l=n.numberStack.pop();return l*=-1,n.numberStack.push(l),void e.$broadcast("number:change",l)}return n.currentNumber*=-1,void e.$broadcast("number:change",n.currentNumber);default:console.log("Operation "+t+" has not been created.")}if(!Number.isInteger(u)&&u){console.log(u);for(var c=0,s=u.toString(),p=null,m=0,d=0;d<s.length;d++){if("."===s[d]){p=d;break}isNaN(s[d])||(m+=1)}if(!r.isNull(p))for(var b=p+1;b<s.length;b++)c+=1;c>14&&1===m&&(u=parseFloat(u).toFixed(14))}if(n.percentageEntered)return void e.$broadcast("number:change",u);n.numberStack.push(u),e.$broadcast("number:change",u)},a=function(e){if(r.isEmpty(e.opStack))e.opStack.push(e.currentOp);else if(e.numberStack.length>1){var t=e.opStack[e.opStack.length-1];if(u(e.currentOp)<u(t)){for(;e.opStack.length>0;)i(t,e),e.opStack.pop(),t=e.opStack[e.opStack.length-1];"resultant"!==e.currentOp&&e.opStack.push(e.currentOp)}else u(e.currentOp)>u(t)?e.opStack.push(e.currentOp):u(e.currentOp)===u(t)&&(i(t,e),e.opStack.pop(),"resultant"!==e.currentOp&&e.opStack.push(e.currentOp))}else e.opStack.push(e.currentOp);n(e)};this.processOperation=function(u,o,l){if("clear"===u.label)t=!1,o.numberStack.length=0,o.opStack.length=0,o.stack.length=0,o.result=null,o.currentNumber=null,o.currentOp=null,e.$broadcast("number:change",0);else if("dot"===u.label)t||(r.isNull(o.currentNumber)?(o.currentNumber="0.",t=!0):(o.currentNumber=o.currentNumber+".",t=!0),e.$broadcast("number:change",o.currentNumber));else if("posneg"===u.label){if(r.isNull(o.currentNumber)&&r.isEmpty(o.numberStack))return;i(u.label,o)}else"percentage"===u.label?i(u.label,o):null!==o.currentNumber?(o.numberStack.push(Number(o.currentNumber)),o.currentOp=u.label,o.currentNumber=null,t=!1,a(o)):"resultant"===u.label?(o.opStack.pop(),o.currentOp=null):(o.opStack.pop(),o.currentOp=u.label,o.opStack.push(u.label));n(o)}}]),angular.module("auxiliary").service("AuxiliaryService",function(){var e=function(e,r){return{symbol:e,label:r}},r=[];r.push(e("C","clear")),r.push(e("+/−","posneg")),r.push(e("%","percentage"));var t=e(".","dot");this.getAux=function(){return r},this.getDot=function(){return t}}),angular.module("main").service("CentralDataService",["$rootScope","OperationLogicService",function(e,r){var t=null,n={numberStack:[],opStack:[],stack:[],result:null,currentNumber:null,currentOp:null,dotEntered:!1,percentageEntered:!1},u={invalidNumber:!1};this.storeCurrentOp=function(e){n.percentageEntered&&(n.percentageEntered=!n.percentageEntered),r.processOperation(e,n,u)},this.storeCurrentNumber=function(r){if(!u.invalidNumber){if(t=r.data,null===n.currentNumber?n.currentNumber=r.data:n.percentageEntered?(n.currentNumber=r.data,n.percentageEntered=!1):n.currentNumber=n.currentNumber.toString()+r.data,n.currentNumber>Math.pow(2,53)||n.currentNumber<-Math.pow(2,53))return n.currentNumber="Number too large",u.invalidNumber=!0,void e.$broadcast("number:change",n.currentNumber);e.$broadcast("number:change",n.currentNumber)}}}]),angular.module("numbers").service("NumbersService",function(){var e=function(e,r){return{data:e,label:r}},r=[];r.push(e(7,"seven")),r.push(e(8,"eight")),r.push(e(9,"nine")),r.push(e(4,"four")),r.push(e(5,"five")),r.push(e(6,"six")),r.push(e(1,"one")),r.push(e(2,"two")),r.push(e(3,"three")),r.push(e(0,"zero")),this.getNumbers=function(){return r}}),angular.module("operations").service("OperationsService",function(){var e=function(e,r){return{symbol:e,label:r}},r=[];r.push(e("÷","division")),r.push(e("×","multiplication")),r.push(e("−","subtraction")),r.push(e("+","addition")),r.push(e("=","resultant")),this.getOperations=function(){return r}}),angular.module("main").service("UtilService",[function(){this.isEmpty=function(e){return 0===e.length},this.isNull=function(e){return null===e}}]),angular.module("main").controller("MainController",function(){});